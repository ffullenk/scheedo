CREATE TABLE categoria (id BIGINT AUTO_INCREMENT, nombre VARCHAR(45), created_at DATETIME NOT NULL, updated_at DATETIME NOT NULL, PRIMARY KEY(id)) ENGINE = INNODB;
CREATE TABLE comentario (id BIGINT AUTO_INCREMENT, texto VARCHAR(150), evento_id BIGINT, user_id BIGINT, created_at DATETIME NOT NULL, updated_at DATETIME NOT NULL, INDEX evento_id_idx (evento_id), INDEX user_id_idx (user_id), PRIMARY KEY(id)) ENGINE = INNODB;
CREATE TABLE evento (id BIGINT AUTO_INCREMENT, nombre VARCHAR(45), user_id BIGINT, categoria_id BIGINT, fecha_inicio DATETIME, fecha_termino DATETIME, lugar VARCHAR(45), logo LONGBLOB, telefono VARCHAR(20), mail VARCHAR(45), twitter VARCHAR(20), facebook VARCHAR(20), web1 VARCHAR(100), ranking BIGINT, descripcion TEXT, is_active TINYINT(1) DEFAULT '1', created_at DATETIME NOT NULL, updated_at DATETIME NOT NULL, INDEX is_active_idx_idx (is_active), INDEX user_id_idx (user_id), INDEX categoria_id_idx (categoria_id), PRIMARY KEY(id)) ENGINE = INNODB;
CREATE TABLE forgot_password (id BIGINT AUTO_INCREMENT, user_id BIGINT NOT NULL, unique_key VARCHAR(255), expires_at DATETIME NOT NULL, created_at DATETIME NOT NULL, updated_at DATETIME NOT NULL, INDEX user_id_idx (user_id), PRIMARY KEY(id)) ENGINE = INNODB;
CREATE TABLE groups (id BIGINT AUTO_INCREMENT, name VARCHAR(255) UNIQUE, description TEXT, created_at DATETIME NOT NULL, updated_at DATETIME NOT NULL, PRIMARY KEY(id)) ENGINE = INNODB;
CREATE TABLE groups_permissions (group_id BIGINT, permission_id BIGINT, created_at DATETIME NOT NULL, updated_at DATETIME NOT NULL, PRIMARY KEY(group_id, permission_id)) ENGINE = INNODB;
CREATE TABLE permissions (id BIGINT AUTO_INCREMENT, name VARCHAR(255) UNIQUE, description TEXT, created_at DATETIME NOT NULL, updated_at DATETIME NOT NULL, PRIMARY KEY(id)) ENGINE = INNODB;
CREATE TABLE remember_key (id BIGINT AUTO_INCREMENT, user_id BIGINT, remember_key VARCHAR(32), ip_address VARCHAR(50), created_at DATETIME NOT NULL, updated_at DATETIME NOT NULL, INDEX user_id_idx (user_id), PRIMARY KEY(id)) ENGINE = INNODB;
CREATE TABLE user_login (id BIGINT AUTO_INCREMENT, username VARCHAR(60) NOT NULL UNIQUE, facebook_uid BIGINT, twitter_uid VARCHAR(45), algorithm VARCHAR(128) DEFAULT 'sha1' NOT NULL, salt VARCHAR(128), password VARCHAR(128), is_active TINYINT(1) DEFAULT '1', is_super_admin TINYINT(1) DEFAULT '0', last_login DATETIME, created_at DATETIME NOT NULL, updated_at DATETIME NOT NULL, INDEX is_active_idx_idx (is_active), PRIMARY KEY(id)) ENGINE = INNODB;
CREATE TABLE user_group (user_id BIGINT, group_id BIGINT, created_at DATETIME NOT NULL, updated_at DATETIME NOT NULL, PRIMARY KEY(user_id, group_id)) ENGINE = INNODB;
CREATE TABLE user_permission (user_id BIGINT, permission_id BIGINT, created_at DATETIME NOT NULL, updated_at DATETIME NOT NULL, PRIMARY KEY(user_id, permission_id)) ENGINE = INNODB;
CREATE TABLE user_profile (id BIGINT AUTO_INCREMENT, user_id BIGINT NOT NULL, first_name VARCHAR(150), last_name VARCHAR(150), address VARCHAR(100), token VARCHAR(32), foto LONGBLOB, ubicacion VARCHAR(45), puntuacion BIGINT, created_at DATETIME NOT NULL, updated_at DATETIME NOT NULL, INDEX user_id_idx (user_id), PRIMARY KEY(id)) ENGINE = INNODB;
ALTER TABLE comentario ADD CONSTRAINT comentario_user_id_user_login_id FOREIGN KEY (user_id) REFERENCES user_login(id) ON DELETE CASCADE;
ALTER TABLE comentario ADD CONSTRAINT comentario_evento_id_evento_id FOREIGN KEY (evento_id) REFERENCES evento(id) ON DELETE CASCADE;
ALTER TABLE evento ADD CONSTRAINT evento_user_id_user_login_id FOREIGN KEY (user_id) REFERENCES user_login(id) ON DELETE CASCADE;
ALTER TABLE evento ADD CONSTRAINT evento_categoria_id_categoria_id FOREIGN KEY (categoria_id) REFERENCES categoria(id);
ALTER TABLE forgot_password ADD CONSTRAINT forgot_password_user_id_user_login_id FOREIGN KEY (user_id) REFERENCES user_login(id) ON DELETE CASCADE;
ALTER TABLE groups_permissions ADD CONSTRAINT groups_permissions_permission_id_permissions_id FOREIGN KEY (permission_id) REFERENCES permissions(id) ON DELETE CASCADE;
ALTER TABLE groups_permissions ADD CONSTRAINT groups_permissions_group_id_groups_id FOREIGN KEY (group_id) REFERENCES groups(id) ON DELETE CASCADE;
ALTER TABLE remember_key ADD CONSTRAINT remember_key_user_id_user_login_id FOREIGN KEY (user_id) REFERENCES user_login(id) ON DELETE CASCADE;
ALTER TABLE user_group ADD CONSTRAINT user_group_user_id_user_login_id FOREIGN KEY (user_id) REFERENCES user_login(id) ON DELETE CASCADE;
ALTER TABLE user_group ADD CONSTRAINT user_group_group_id_groups_id FOREIGN KEY (group_id) REFERENCES groups(id) ON DELETE CASCADE;
ALTER TABLE user_permission ADD CONSTRAINT user_permission_user_id_user_login_id FOREIGN KEY (user_id) REFERENCES user_login(id) ON DELETE CASCADE;
ALTER TABLE user_permission ADD CONSTRAINT user_permission_permission_id_permissions_id FOREIGN KEY (permission_id) REFERENCES permissions(id) ON DELETE CASCADE;
ALTER TABLE user_profile ADD CONSTRAINT user_profile_user_id_user_login_id FOREIGN KEY (user_id) REFERENCES user_login(id) ON DELETE CASCADE;
